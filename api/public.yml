openapi: "3.0.0"
info:
  version: 1.0.0
  title: tzetypes-badminton
  description: tzetypes-badminton
  contact:
    name: ezekiel
    url: https://github.com/ezekielchow
servers:
  - url: https://{hostname}
    variables:
      hostname:
        default: localhost
paths:
  /login:
    post:
      tags:
        - users
      operationId: login
      requestBody:
        description: login user
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LoginRequestSchema"
      responses:
        "200":
          description: login response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LoginResponseSchema"
        default:
          $ref: "#/components/responses/ErrorResponseSchema"
  /signup:
    post:
      tags:
        - users
      operationId: signup
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SignupRequestSchema"
      responses:
        "201":
          description: signup success
        default:
          $ref: "#/components/responses/ErrorResponseSchema"

  /refresh-token:
    post:
      tags:
        - users
      operationId: refresh-token
      responses:
        "200":
          description: refresh token success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RefreshTokenResponseSchema"
        default:
          $ref: "#/components/responses/ErrorResponseSchema"

  /game/{game_id}:
    get:
      summary: Get game and steps given id
      operationId: getGame
      tags:
        - game
      parameters:
        - in: path
          name: game_id
          required: true
          description: The unique identifier of the game
          schema:
            type: string
      responses:
        "200":
          description: Get game successfully
          content:
            application/json:
              schema:
                type: object
                required:
                  - steps
                  - game
                properties:
                  steps:
                    type: array
                    items:
                      $ref: "#/components/schemas/GameStep"
                  game:
                    $ref: "#/components/schemas/Game"
                  statistics:
                    $ref: "#/components/schemas/GameStatistic"
        default:
          $ref: "#/components/responses/ErrorResponseSchema"
components:
  schemas:
    LoginRequestSchema:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          minLength: 8

    LoginResponseSchema:
      type: object
      required:
        - session_token
        - refresh_token
      properties:
        session_token:
          type: string
        refresh_token:
          type: string

    SignupRequestSchema:
      type: object
      required:
        - email
        - password
        - password_repeat
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          minLength: 8
        password_repeat:
          type: string
          minLength: 8

    RefreshTokenResponseSchema:
      type: object
      required:
        - session_token
      properties:
        session_token:
          type: string

    Error:
      type: object
      required:
        - message
      properties:
        message:
          type: string

    GameStatistic:
      type: object
      required:
        - total_game_time
        - left_consecutive_points
        - right_consecutive_points
        - longest_point
        - longest_point_team
        - shortest_point
        - shortest_point_team
        - average_per_point
        - left_average_per_point
        - right_average_per_point
      properties:
        total_game_time:
          type: string
        left_consecutive_points:
          type: string
        right_consecutive_points:
          type: string
        longest_point:
          type: string
        longest_point_team:
          type: string
        shortest_point:
          type: string
        shortest_point_team:
          type: string
        average_per_point:
          type: string
        left_average_per_point:
          type: string
        right_average_per_point:
          type: string

    Game:
      type: object
      required:
        - id
        - club_id
        - left_odd_player_name
        - left_even_player_name
        - right_odd_player_name
        - right_even_player_name
        - game_type
        - serving_side
        - is_ended
        - created_at
        - updated_at
      properties:
        id:
          type: string
        club_id:
          type: string
        left_odd_player_name:
          type: string
        left_even_player_name:
          type: string
        right_odd_player_name:
          type: string
        right_even_player_name:
          type: string
        game_type:
          type: string
        serving_side:
          type: string
        is_ended:
          type: boolean
        created_at:
          type: string
        updated_at:
          type: string

    GameStep:
      type: object
      required:
        - id
        - game_id
        - team_left_score
        - team_right_score
        - score_at
        - step_num
        - current_server
        - left_odd_player_name
        - left_even_player_name
        - right_odd_player_name
        - right_even_player_name
        - created_at
        - updated_at
      properties:
        id:
          type: string
        game_id:
          type: string
        team_left_score:
          type: integer
        team_right_score:
          type: integer
        score_at:
          type: string
        step_num:
          type: integer
        current_server:
          type: string
        left_odd_player_name:
          type: string
        left_even_player_name:
          type: string
        right_odd_player_name:
          type: string
        right_even_player_name:
          type: string
        sync_id:
          type: string
        created_at:
          type: string
        updated_at:
          type: string

  responses:
    ErrorResponseSchema:
      description: Error res
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
